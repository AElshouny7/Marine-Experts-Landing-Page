---
import Base from '~/layouts/Base.astro';
import Header from '~/components/Header.astro';
import Footer from '~/components/Footer.astro';
import LogoCloud from '~/components/LogoCloud.astro';
import ServiceCard from '~/components/ServiceCard.astro';
import MetricsStrip from '~/components/MetricsStrip.astro';
import HowItWorks from '~/components/HowItWorks.astro';
import Differentiators from '~/components/Differentiators.astro';
import CTASection from '~/components/CTASection.astro';
import MetaTags from '~/components/MetaTags.astro';

// Islands
import PricingTable from '~/components/PricingTable.tsx';
import FAQAccordion from '~/components/FAQAccordion.tsx';
import ContactForm from '~/components/ContactForm.tsx';

import { company, trustBadges, services, pricing, faqs, cases } from '~/content/site';
import { orgJsonLd, faqJsonLd } from '~/utils/seo';

const ab = Astro.cookies.get('ab')?.value || 'heroA';
const heroTitle = ab === 'heroB'
  ? 'Complete offshore and quayside solutions'
  : 'Complete offshore and quayside solutions';
const heroCta = ab === 'heroB' ? 'Speak to an Engineer' : company.primaryCTAs[1].label;

const domain = import.meta.env.PLAUSIBLE_DOMAIN || 'marineexpertsuae.com';
const site = Astro.site?.origin || import.meta.env.SITE || 'https://marineexpertsuae.com';
const pageTitle = "Marine Experts â€” Complete offshore and quayside solutions";
const pageDesc = company.description;
---

<Base title={pageTitle}>
  <Fragment slot="head">
    <MetaTags title={pageTitle} description={pageDesc} url={site} />
    <link rel="canonical" href={site} />
    <link rel="preload" as="image" href="/images/hero-harbor.jpg" />
    <link rel="manifest" href="/manifest.webmanifest" />

    <!-- Plausible loader + queue shim (shim served from /public, so no TS inlining) -->
    <script defer data-domain={domain} src="https://plausible.io/js/plausible.js"></script>
    <script defer data-domain={domain} src="https://plausible.io/js/plausible.outbound-links.js"></script>
    <script src="/plausible-shim.js" is:inline></script>

    <script type="application/ld+json">
      {JSON.stringify(orgJsonLd(site), null, 2)}
    </script>

    <script type="application/ld+json">
      {JSON.stringify(faqJsonLd(faqs, site), null, 2)}
    </script>

  </Fragment>
    <Header />

    <main id="main">
      <section class="relative isolate">
        <img
          src="/images/hero-harbor.jpg"
          alt="Harbor operations with vessels at berth"
          class="absolute inset-0 -z-10 w-full h-full object-cover opacity-25"
          loading="eager"
        />
        <div class="container py-16 md:py-24">
          <div class="max-w-2xl">
            <h1 class="text-4xl md:text-5xl font-semibold text-navy">{heroTitle}</h1>
            <p class="mt-4 text-slate">{company.description}</p>
            <div class="mt-6 flex flex-wrap gap-4">
              <a
                href="#contact"
                data-track="cta"
                data-label="Talk to an Engineer"
                data-variant={ab}
                class="px-5 py-3 rounded-xl bg-teal text-white font-medium"
              >{company.primaryCTAs[0].label}</a>

              <!-- <a
                href={company.primaryCTAs[1].href}
                data-track="cta"
                data-label={heroCta}
                data-variant={ab}
                class="px-5 py-3 rounded-xl border border-navy text-navy font-medium hover:bg-sand/50"
              >{heroCta}</a> -->

              <!-- <a
                class="px-5 py-3 rounded-xl bg-white text-navy font-medium border border-sand"
                href={company.secondaryCTA.href}
                data-track="cta"
                data-label="Download Capabilities Deck"
                data-variant={ab}
              >{company.secondaryCTA.label}</a> -->
            </div>

            <div class="mt-8 flex gap-4 items-center">
              {trustBadges.map((b) => (
                <img src={b.src} width="44" height="44" alt={b.alt} />
              ))}
            </div>
          </div>
        </div>
      </section>

      <LogoCloud />

      <section id="services" class="container py-12">
        <h2 class="text-2xl md:text-3xl font-semibold text-navy">Services & Capabilities</h2>
        <div class="mt-6 grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
          {services.map((s) => <ServiceCard {...s} />)}
        </div>
      </section>

      <HowItWorks />

      <Differentiators />

      <MetricsStrip />

      <!-- <PricingTable client:idle monthly={pricing.monthly} perCall={pricing.perCall} /> -->

      <section id="cases" class="container py-12">
        <h2 class="text-2xl md:text-3xl font-semibold text-navy">Case Snippets</h2>
        <div class="mt-6 grid md:grid-cols-2 gap-6">
          <article class="rounded-2xl border border-sand p-6">
            <h3 class="text-lg font-semibold text-navy">{cases[0].title}</h3>
            <p class="mt-2 text-sm text-slate">{cases[0].text}</p>
            <p class="mt-2 text-sm font-medium text-navy">Result: {cases[0].result}</p>
          </article>
          <article class="rounded-2xl border border-sand p-6">
            <h3 class="text-lg font-semibold text-navy">{cases[1].title}</h3>
            <p class="mt-2 text-sm text-slate">{cases[1].text}</p>
            <p class="mt-2 text-sm font-medium text-navy">Result: {cases[1].result}</p>
          </article>
        </div>
      </section>

      <FAQAccordion client:idle faqs={faqs} />

      <CTASection />

      <ContactForm client:idle siteKey={import.meta.env.HCAPTCHA_SITEKEY} />
    </main>

    <Footer />

	 <!-- CTA tracking (served from /public, so no TS diagnostics) -->
  <script src="/cta-track.js" is:inline></script>

    <script type="application/ld+json">{JSON.stringify(orgJsonLd(), null, 2)}</script>
    <script type="application/ld+json">{JSON.stringify(faqJsonLd(faqs), null, 2)}</script>
  </body>
</html>
